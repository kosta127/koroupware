<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="kosta.elecauth.mapper.Elec_authMapper">
	<cache />
	<select id="elec_authList" resultType="Elec_authList">
		SELECT ea.elec_auth_no, ea.elec_auth_title, ea.elec_auth_regdate, ea.elec_auth_processing_period,
			do.doc_title, de.dept_name, e.emp_name, (CASE WHEN 
         																 (SELECT count(*)
          																  FROM approval_list al
          																  WHERE ea.elec_auth_no = al.elec_auth_no) 
          																  =(SELECT count(*)
         																	 FROM approval_list al
          																	 WHERE ea.elec_auth_no = al.elec_auth_no
           																	 AND al.approval_list_pass='Y') THEN '진행완료' ELSE '진행중'
         															         END ) approval_list_pass
		FROM elec_auth ea, doc do, dept de, emp e
		WHERE ea.doc_no=do.doc_no
		AND ea.elec_auth_management_dept_no=de.dept_no
		AND ea.emp_no=e.emp_no
	</select>
	
	<select id="getTotalCount" resultType="int">
		SELECT COUNT(*) FROM elec_auth
	</select>
	
	<select id="elec_authDetail" resultType="Elec_authDetail" parameterType="int">
		SELECT * 
		FROM elec_auth ea, doc do, dept de, emp e, position p, office o
		WHERE ea.doc_no=do.doc_no 
			AND ea.elec_auth_send_dept_no=de.dept_no 
			AND ea.emp_no=e.emp_no 
			AND e.position_no=p.position_no 
			AND e.office_no=o.office_no 
			AND ea.elec_auth_no=#{elec_auth_no}
	</select>
	

	
	<insert id="insertElecAuth" parameterType="ELec_auth">
		INSERT INTO ELEC_AUTH(elec_auth_no, emp_no, elec_auth_management_dept_no,
                      elec_auth_title, elec_auth_contents,
                      elec_auth_processing_period, 
                      elec_auth_temporary_saveYN, elec_auth_con_period,
                      doc_no, elec_auth_regdate, elec_auth_deldate)
        	VALUES(TEST_SEQ.NEXT_VAL, #{emp_no}, #{elec_auth_management_dept_no},
        			#{elec_auth_title}, #{elec_auth_contents},
        			#{elec_auth_processing_period},
        			#{elec_auth_temporary_saveYN}, #{elec_auth_con_period},
        			#{doc_no}, SYSDATE, NULL)
	</insert>
	
	<select id="serchEmpDetail" parameterType="String" resultType="EmpDetail">
		SELECT e.*, d.dept_name, o.office_name, p.position_name
 		 FROM emp e INNER JOIN dept d ON e.dept_no = d.dept_no
      		 INNER JOIN office o ON e.office_no = o.office_no
     		 INNER JOIN position p ON e.position_no = p.position_no
  		WHERE emp_name like #{searchKeyword}
	</select>
</mapper>















